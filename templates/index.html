<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ brand }} â€“ {{ cfg.company or cfg.full_name }}</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="chat-card">
    <h1>{{ brand }}</h1>

    <!-- Avatar de bienvenue -->
    <div class="avatar">
      <img src="https://i.postimg.cc/2jPPVYvb/20251016-1145-Futuristic-Android-Elegance-simple-compose-01k7p6f22kfsb8j27psehwqq3c.png"
           alt="Avatar de Betty - Assistante IA" />
    </div>

    <p class="subtitle">Votre assistante IA personnelle</p>

    <div id="chat">
      <div id="messages">
        <div class="bubble bot">ðŸ‘‹ Bonjour, je suis Betty. Comment puis-je vous aider aujourdâ€™hui ?</div>
      </div>
      <div class="row">
        <input id="msg" placeholder="Posez votre questionâ€¦" />
        <button id="send">Envoyer</button>
      </div>
    </div>

    <p class="tiny">Client: {{ cfg.full_name }} â€“ {{ cfg.email }} â€” ID: {{ tenant_id }}</p>
  </div>

  <script>
    const tenantId={{ tenant_id|tojson }};
    const sendBtn=document.getElementById('send');
    const input=document.getElementById('msg');
    const messages=document.getElementById('messages');
    function addBubble(text,who){
      const div=document.createElement('div');
      div.className=`bubble ${who}`;
      div.textContent=text;
      messages.appendChild(div);
      messages.scrollTop=messages.scrollHeight;
    }
    sendBtn.onclick=async()=>{
      const text=input.value.trim();
      if(!text)return;
      addBubble(text,'user');
      input.value='';
      const res=await fetch(`/api/chat/${tenantId}`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({message:text})
      });
      const data=await res.json();
      addBubble(data.reply||'â€¦','bot');
    };
    input.addEventListener('keydown',(e)=>{if(e.key==='Enter')sendBtn.click();});
  </script>
</body>
</html>
