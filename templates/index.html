<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ brand }} – {{ cfg.company or cfg.full_name }}</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="chat-card">
    <h1>{{ brand }}</h1>
    <p class="subtitle">Assistant(e) IA pour {{ cfg.company or 'votre activité' }}</p>
    <div id="chat">
      <div id="messages"></div>
      <div class="row">
        <input id="msg" placeholder="Posez votre question…" />
        <button id="send">Envoyer</button>
      </div>
    </div>
    <p class="tiny">Client: {{ cfg.full_name }} – {{ cfg.email }} — ID: {{ tenant_id }}</p>
  </div>
  <script>
    const tenantId={{ tenant_id|tojson }};
    const sendBtn=document.getElementById('send');
    const input=document.getElementById('msg');
    const messages=document.getElementById('messages');
    function addBubble(text,who){
      const div=document.createElement('div');
      div.className=`bubble ${who}`;
      div.textContent=text;
      messages.appendChild(div);
      messages.scrollTop=messages.scrollHeight;
    }
    sendBtn.onclick=async()=>{
      const text=input.value.trim();
      if(!text)return;
      addBubble(text,'user');
      input.value='';
      const res=await fetch(`/api/chat/${tenantId}`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({message:text})
      });
      const data=await res.json();
      addBubble(data.reply||'…','bot');
    };
    input.addEventListener('keydown',(e)=>{if(e.key==='Enter')sendBtn.click();});
  </script>
</body>
</html>
